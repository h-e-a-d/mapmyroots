# Vulnerability Matrix - Quick Reference

## Critical Vulnerabilities (Fix First)

| ID | Vulnerability | Location | CVSS | Fix Time | Status |
|----|---------------|----------|------|----------|--------|
| CRIT-01 | Missing Content Security Policy | All HTML files | 7.5 | 1h | ‚¨ú Open |
| CRIT-02 | Unsanitized innerHTML (29 instances) | 11 JS files | 8.2 | 4h | ‚¨ú Open |

**Total Critical Fix Time: 5 hours**

---

## High Priority Vulnerabilities

| ID | Vulnerability | Location | CVSS | Fix Time | Status |
|----|---------------|----------|------|----------|--------|
| HIGH-01 | Missing Security Headers | All HTML files | 6.5 | 0.5h | ‚¨ú Open |
| HIGH-02 | Unencrypted LocalStorage | core-cache.js | 6.0 | 3h | ‚¨ú Open |
| HIGH-03 | No SRI on CDN Resources | exporter.js, HTML | 7.0 | 1h | ‚¨ú Open |
| HIGH-04 | Inadequate Date Validation | security-utils.js | 5.5 | 1h | ‚¨ú Open |
| HIGH-05 | GDPR Non-Compliance | All HTML files | N/A | 2h | ‚¨ú Open |

**Total High Priority Fix Time: 7.5 hours**

---

## Medium Priority Issues

| ID | Vulnerability | Location | CVSS | Fix Time | Status |
|----|---------------|----------|------|----------|--------|
| MED-01 | Weak ID Generation | tree-engine.js:760 | 4.5 | 0.5h | ‚¨ú Open |
| MED-02 | Error Info Leakage | exporter.js | 4.0 | 1h | ‚¨ú Open |
| MED-03 | No Rate Limiting | All save operations | 5.0 | 2h | ‚¨ú Open |
| MED-04 | Unsafe JSON Parsing | security-utils.js:180 | 4.5 | 1h | ‚¨ú Open |
| MED-05 | Missing Autocomplete | builder.html | 3.0 | 0.5h | ‚¨ú Open |
| MED-06 | Clickjacking Risk | All pages | 4.5 | 0h* | ‚¨ú Open |
| MED-07 | No Session Timeout | N/A | 4.0 | 2h | ‚¨ú Open |
| MED-08 | Cross-Tab Race Conditions | core-cache.js | 3.5 | 1h | ‚¨ú Open |

*Fixed by HIGH-01

**Total Medium Priority Fix Time: 8 hours**

---

## Low Priority / Recommendations

| ID | Item | Type | Fix Time | Status |
|----|------|------|----------|--------|
| LOW-01 | Add HTTPS Enforcement | Enhancement | 0.5h | ‚¨ú Open |
| LOW-02 | Implement Security.txt | Best Practice | 0.5h | ‚¨ú Open |
| LOW-03 | Add Dependency Scanning | DevSecOps | 1h | ‚¨ú Open |
| LOW-04 | Security Event Logging | Monitoring | 3h | ‚¨ú Open |
| LOW-05 | Add Input Length Limits | Hardening | 1h | ‚¨ú Open |
| LOW-06 | Add robots.txt | Info Disclosure | 0.5h | ‚¨ú Open |

**Total Low Priority Fix Time: 6.5 hours**

---

## Files Requiring Changes

### Critical & High Priority Files

```
Priority 1-2 (Must Fix):
‚îú‚îÄ‚îÄ index.html (CSP, headers, consent)
‚îú‚îÄ‚îÄ builder.html (CSP, headers, consent)
‚îú‚îÄ‚îÄ about.html (CSP, headers)
‚îú‚îÄ‚îÄ contact.html (CSP, headers)
‚îú‚îÄ‚îÄ terms.html (CSP, headers)
‚îú‚îÄ‚îÄ src/ui/modals/modal.js (innerHTML x4)
‚îú‚îÄ‚îÄ src/features/search/search.js (innerHTML x2)
‚îú‚îÄ‚îÄ src/ui/components/searchableSelect.js (innerHTML x3)
‚îú‚îÄ‚îÄ src/ui/components/ui-modals.js (innerHTML x2)
‚îú‚îÄ‚îÄ src/ui/components/ui-settings.js (innerHTML x3)
‚îú‚îÄ‚îÄ src/ui/components/table.js (innerHTML x1)
‚îú‚îÄ‚îÄ src/ui/components/notifications.js (innerHTML x4)
‚îú‚îÄ‚îÄ src/tutorial/TutorialUI.js (innerHTML x5)
‚îú‚îÄ‚îÄ src/tutorial/SimpleTutorial.js (innerHTML x2)
‚îú‚îÄ‚îÄ src/features/i18n/language-switcher.js (innerHTML x2)
‚îú‚îÄ‚îÄ src/features/i18n/i18n.js (innerHTML x1)
‚îî‚îÄ‚îÄ src/features/export/exporter.js (SRI)

Total Files: 17
Total Changes: ~50 edits
```

---

## innerHTML Instances to Fix

| File | Line | Code | Priority |
|------|------|------|----------|
| modal.js | 91 | `titleEl.innerHTML = '';` | Safe (clearing) |
| modal.js | 139 | `titleEl.innerHTML = \`<span>...\` | CRITICAL |
| modal.js | 290 | `container.innerHTML = '';` | Safe (clearing) |
| modal.js | 985 | `titleEl.innerHTML = \`...\` | CRITICAL |
| searchableSelect.js | 61 | `c.innerHTML = '';` | Safe (clearing) |
| searchableSelect.js | 105 | `optionsWrapper.innerHTML = buildOptions(...)` | CRITICAL |
| ui-modals.js | 97 | `modal.innerHTML = \`...\` | CRITICAL |
| ui-modals.js | 1134 | `html: button.innerHTML` | Medium (read-only) |
| ui-settings.js | 404 | `modal.innerHTML = \`...\` | CRITICAL |
| ui-settings.js | 608 | `shapeOptionsContainer.innerHTML = '';` | Safe (clearing) |
| ui-settings.js | 611 | `shapeOptionsContainer.innerHTML = '<p>...'` | CRITICAL |
| table.js | 113 | `tbody.innerHTML = '';` | Safe (clearing) |
| notifications.js | 44 | `icon.innerHTML = '<div>...'` | CRITICAL |
| notifications.js | 46 | `icon.innerHTML = this.getIcon(type)` | CRITICAL |
| notifications.js | 70 | `closeBtn.innerHTML = '√ó'` | Safe (static) |
| notifications.js | 122 | `iconEl.innerHTML = '<div>...'` | CRITICAL |
| notifications.js | 124 | `iconEl.innerHTML = this.getIcon(...)` | CRITICAL |
| TutorialUI.js | 28 | `this.modal.innerHTML = \`...\` | CRITICAL |
| TutorialUI.js | 423 | `content.innerHTML = stepData.content` | CRITICAL |
| TutorialUI.js | 447 | `container.innerHTML = '';` | Safe (clearing) |
| TutorialUI.js | 451 | `container.innerHTML = \`...\` | CRITICAL |
| TutorialUI.js | 457 | `container.innerHTML = \`...\` | CRITICAL |
| TutorialUI.js | 467 | `container.innerHTML = \`...\` | CRITICAL |
| SimpleTutorial.js | 289 | `this.modal.innerHTML = \`...\` | CRITICAL |
| SimpleTutorial.js | 389 | `...innerHTML = step.content` | CRITICAL |
| search.js | 302 | `this.suggestions.innerHTML = suggestionsHTML` | CRITICAL |
| search.js | 309 | `this.suggestions.innerHTML = '';` | Safe (clearing) |
| language-switcher.js | 312 | `dropdown.innerHTML = '';` | Safe (clearing) |
| language-switcher.js | 327 | `option.innerHTML = \`...\` | CRITICAL |
| i18n.js | 384 | `element.innerHTML = translation` | CRITICAL |

**Summary:**
- Total: 29 instances
- CRITICAL (needs sanitization): 18
- Safe (clearing or static): 11

---

## Security Headers Checklist

### Required Headers

- [ ] Content-Security-Policy
  - [ ] default-src 'self'
  - [ ] script-src (with allowed CDNs)
  - [ ] style-src (with allowed domains)
  - [ ] img-src 'self' data: https:
  - [ ] frame-ancestors 'none'

- [ ] X-Frame-Options: DENY
- [ ] X-Content-Type-Options: nosniff
- [ ] Referrer-Policy: strict-origin-when-cross-origin
- [ ] Permissions-Policy: geolocation=(), microphone=(), camera=()

### Optional but Recommended

- [ ] Strict-Transport-Security (for HTTPS)
- [ ] X-XSS-Protection: 1; mode=block (legacy browsers)

---

## GDPR Compliance Checklist

- [ ] Cookie consent banner implemented
- [ ] Analytics loads only after consent
- [ ] Consent preference stored
- [ ] Privacy policy link visible
- [ ] Data export functionality (partially exists)
- [ ] Right to deletion (exists via Clear All)
- [ ] Data minimization (collect only necessary data)
- [ ] Transparent data usage information

---

## Testing Checklist

### XSS Testing

Test these inputs in all form fields:
```
<script>alert('XSS')</script>
<img src=x onerror=alert('XSS')>
javascript:alert('XSS')
<svg onload=alert('XSS')>
';alert('XSS');//
"><script>alert('XSS')</script>
```

Expected: All should be sanitized/escaped

### Security Headers Testing

```bash
# Test CSP
curl -I https://your-domain.com | grep -i "content-security-policy"

# Test other headers
curl -I https://your-domain.com | grep -i "x-frame-options\|x-content-type"
```

### Privacy Testing

1. Clear localStorage: `localStorage.clear()`
2. Reload page
3. Verify cookie banner appears
4. Test both Accept and Reject
5. Verify choice persists
6. Check analytics loads only after consent

---

## Fix Priority Order

### Week 1: Critical Fixes (5 hours)
1. ‚úÖ Add CSP to all HTML files (1h)
2. ‚úÖ Install DOMPurify (0.5h)
3. ‚úÖ Fix 18 critical innerHTML instances (4h)

### Week 1: High Priority (7.5 hours)
4. ‚úÖ Add security headers (0.5h)
5. ‚úÖ Add SRI to CDN resources (1h)
6. ‚úÖ Implement cookie consent (2h)
7. ‚è∏Ô∏è Encrypt localStorage (defer to week 2)
8. ‚úÖ Fix date validation (1h)

### Week 2: Medium Priority (8 hours)
9. ‚úÖ Fix ID generation (0.5h)
10. ‚úÖ Improve error handling (1h)
11. ‚úÖ Add rate limiting (2h)
12. ‚úÖ Fix JSON parsing (1h)
13. ‚úÖ Add autocomplete attributes (0.5h)
14. ‚úÖ Implement session timeout (2h)
15. ‚úÖ Fix cross-tab issues (1h)

### Week 3: Low Priority & Monitoring (6.5 hours)
16. ‚úÖ HTTPS enforcement (0.5h)
17. ‚úÖ Security.txt (0.5h)
18. ‚úÖ Dependency scanning (1h)
19. ‚úÖ Security logging (3h)
20. ‚úÖ Input length limits (1h)
21. ‚úÖ robots.txt (0.5h)

**Total Estimated Time: 27 hours**

---

## Risk Score Calculation

### Before Fixes

| Category | Weight | Score | Weighted |
|----------|--------|-------|----------|
| XSS Prevention | 25% | 3/10 | 0.75 |
| Security Headers | 20% | 0/10 | 0.0 |
| Data Protection | 20% | 4/10 | 0.8 |
| Dependency Security | 15% | 3/10 | 0.45 |
| Privacy/Compliance | 20% | 0/10 | 0.0 |

**Total Risk Score: 2.0/10** üî¥ **HIGH RISK**

### After All Fixes

| Category | Weight | Score | Weighted |
|----------|--------|-------|----------|
| XSS Prevention | 25% | 9/10 | 2.25 |
| Security Headers | 20% | 10/10 | 2.0 |
| Data Protection | 20% | 8/10 | 1.6 |
| Dependency Security | 15% | 9/10 | 1.35 |
| Privacy/Compliance | 20% | 10/10 | 2.0 |

**Total Risk Score: 9.2/10** üü¢ **LOW RISK**

---

## Progress Tracking

Use this to track your fixes:

```
Critical Fixes:
[‚¨ú] CRIT-01: Add CSP
[‚¨ú] CRIT-02: Sanitize innerHTML (0/18 done)

High Priority:
[‚¨ú] HIGH-01: Security headers
[‚¨ú] HIGH-02: Encrypt localStorage
[‚¨ú] HIGH-03: Add SRI
[‚¨ú] HIGH-04: Fix date validation
[‚¨ú] HIGH-05: GDPR consent

Medium Priority:
[‚¨ú] MED-01: ID generation
[‚¨ú] MED-02: Error handling
[‚¨ú] MED-03: Rate limiting
[‚¨ú] MED-04: JSON parsing
[‚¨ú] MED-05: Autocomplete
[‚¨ú] MED-07: Session timeout
[‚¨ú] MED-08: Cross-tab sync

Low Priority:
[‚¨ú] LOW-01: HTTPS enforcement
[‚¨ú] LOW-02: Security.txt
[‚¨ú] LOW-03: Dependency scanning
[‚¨ú] LOW-04: Security logging
[‚¨ú] LOW-05: Input limits
[‚¨ú] LOW-06: robots.txt
```

---

## Quick Command Reference

```bash
# Count innerHTML usage
grep -r "\.innerHTML" src/ --include="*.js" | wc -l

# Find all innerHTML instances with line numbers
grep -rn "\.innerHTML" src/ --include="*.js"

# Test CSP (after deployment)
curl -I https://your-domain.com | grep -i content-security

# Validate HTML
https://validator.w3.org/

# Test XSS
# Use browser console in form fields
```

---

## Support Resources

- **Full Report:** SECURITY_AUDIT_REPORT.md
- **Quick Start:** SECURITY_FIXES_QUICK_START.md
- **Executive Summary:** SECURITY_AUDIT_EXECUTIVE_SUMMARY.md
- **This Matrix:** VULNERABILITY_MATRIX.md

**Need help?** Reference the detailed reports for code examples and step-by-step instructions.

---

**Last Updated:** October 19, 2025
**Next Review:** After critical fixes implemented
